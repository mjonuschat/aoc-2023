#!/usr/bin/env python
# coding: utf-8

# In[3]:


INPUT = r"""
\.-/...-\......../.|......|.........../..-..................|....-.\............................../...........
..........-.............\...\.........|..\.......................-..........-.......\.../.......-/............
........|.............-.....|..|........................\.\.../../.....-........................\.............
....../\.....................|........|.....-...........-..\......./-.............................-........./.
.\..\.............-........|.......|...|..............................-..-......-......|......................
..........|/...\.............\............../-......\.../........................./............./.../......../
..............\......./..-...............|...........\...|............|...........-..-............|...........
..........-...............|..././...........................................|...........-.../.-.|.....|.......
.........-...|..................-...........\.-...................../.../........................|/......./...
.................................-.././...................|\..............|.........../.......................
.............../......-.................\....--.....-............................./.|./.................|.....
..../....|...|..................../....\...|............|...../.././../--......\.\....|.......-............\./
......\....-...|......\...........-......./..................../.....-..............\.............|......./...
............|.\...................|.........................|........\............................./.\.......|
............../...............................|.........../.................\-.................../........../.
.|....|...........|..................|......./|\\.|\.-...\..../.........//........|............../...........|
........................|.....--......|.............-..................\...../..../.......-....|...\..........
...............\........-........../...-|............\......./.\...........-|................/.-..............
..../....|.\.............|......|...............................................|.................\...........
.\...\......./.....|.\....|..................-../|-......................|.................-..|......\........
.../.........................................\.....././....................|.......-........-......\....|.....
.................\./\..-../......../...\................................-......-..\...........................
.......--..-........\/........./........../...............\..............\...-........-......-../.........|...
.|...............-........./..............\..\......................|......./..|..............-.......|.|.....
........./............\............|........\...|...\........-.......................|...................\....
..................-\......../.................\.......\.....|...........|..|-........\.............|.......\\.
...|.........../.......|...../...|...\........\\...................................-............-../...../....
......./....................|.........../...-................-....................\.......|...................
\....\.......................-.|.\...../..-...................|......................-..................../...
......|........-|...-/.|........................./.....|.....\.........-........-......-.............././.....
......|.............-.\...............................\..|....\..............|./..|./...\......./..........|\|
......././.\...................-...-............/...................|/..........-\./.................|........
.........|..........|\../.........\..............-.........\................../\./.............-..............
...\.......................\..................................\...........................................|...
...|........\..........|....|..../..|.........-\.................-...-..\.\.........\............|....|...//..
.././.....|.....-..........|.................\.........\........./......-...-.\.\.....................\.......
......./....\........\\..\...|...../.................|.......|.\.....\............................../\....\...
.........\......../.\............|...............................................................|/...........
.\.....-\-.........|.........|....|...........-....\.....|................\...............-............./.....
.....-..............................-.....-..........-..................../..../........................|.....
...........\...........-/....................-.....-............/........|........-/.........--./........-..\\
.|................................................|..................-.......|.............|\/................
.|.................-.-..........|.........................../..../....../.....\...../......./.................
........./..../..|..........\..................\....................................................../.......
.........\............|.../......../........|......................../..../...|.\...\......................|..
........./................\.............\........|....................\./......|.........-....../...../.......
..../.....|...../........-...................|............/.....||...............-....-.-.....................
\./...\.|...|.............|.......\....../|...\\/.|.../....-.........\\|..|....-........\............-.......|
......\-..............|.....\.....|...\..............................|.....................\......-.....|.....
......\.-..........-..|......................................-..../......................../........\.......|.
/...................-...\.........--.............................\...........\................|......./.......
.................-......-..../..\.............-./|......-....\...........-...................\.....|........-.
|........--.............\...-....|.......|.\............|...../\...........\/../............................-.
...|./-..\.|...........\........../..............................\......-.......-.....|..........-........./..
.......-|..................-..........|..-............................../.............|..|.||.................
....-......................\....\..................\......./............./..-........|..............-....|....
-..........-.........-.../|........--.............-................|..../|.................|..................
...\......./..\..\......./|.....|-.............-............................\..\......\...-..\...............\
./......................|..........\...........|.|.......\..........\......................................\..
................|...............-.../....\......./.\........-..............................|...-....-.........
..\.......................\..../..|.-.........-.............\.......|../.|.|..|........|..............-.......
...........\................\..........................\.....................\........|.......................
..........|....\.......\...........|...../......................................./...\.../........../.........
./...............\...........|..-....-./..\...\...\../...............-\............\....\............-........
././............|................|........../...\...../.............-....-.............\......................
....-.|..................../.............................-...............................|....................
..-......|....-.........-...\......\.........||....-.\............................-...|..............|........
........\...........\.-.......\.../.........\.../.....|.................../..|..|....\..../..-................
..........-..................\..|...|.|..\......................./...........-......./.............|..\...../.
.\......|\.|..\.......|\.-.......-........../........../..........\.........../.........|.....................
./..........|..................//.|......|........-...\...//............-.../..............|.......-....-.....
...............\......\........|.-................\......-...................|.............-............-.-...
...........................\/...........\../..\....................\...........|.............-..........-.....
.............../........\|.........\..........-......../............-..........|........|/....................
....\................-..................././........|.....|...........................-..|....................
\-............-.......\......\.................../.......-.../............/....-..\.......|................|..
.........................../....../.|...\/...\........-|.|.......\..-........-............................../.
.................\.....................|..........|.............|......|/.\..........................-........
....\../................................|.......-......|.................-......................|...-.../.....
....-.........|..../|..............................-|...............................-..-......\.....-.........
./\...............|.|..............-./..|........./...................................................\.......
..............-....\..|....../.....\.............\..............................-...-..../.....|..............
........-.........|..............................................-....\--...........|\...................../..
................/.|.................-....|......./............-...................../.-./\................|...
................|............................../..-./.....|..-........................./.....|..............-.
....../........../.......|...|.....\........./.............|..................................|.|.............
....................................................||.....|................/......-....../....../............
.........../.....\...................|...........\../....................................../.............../..
./.|............../.............................\..|....\-............./......................................
.........\................../-.....|...........\................|...../..................................|....
..|...../.....|...............\.....-.................................|/............-..|..-...|......-........
....|....-..............|.......|............./\-...........\//.........|...........\...../..............--...
.............-........\|...........................-....../....||............/......./....................../.
|..................-......\.........-.......|..............................\.|/..................\......\.-...
....../.......................|........|..|.\...........|.........\................\\..................\.../..
...........-....|...........||...-.......|.|....-.....\\-................|.........../..................\/....
................|.-.................|-./..-..|.........-..............-.........-../........................-.
.....................-.....................................|.........\......||./................|.............
............/...-............|......./......................................../..........................-....
..../.......\.-............|..........|....-...........\.-.................................\./...|............
...........|.-........|.|....-...........\......-...-..........|.\.|.|.....\....\............../..............
......\...\....../....\......\.|......................./.......................\.................../..../\....
...../.|...............|.../\.........................................-...........|./........................|
.........................-.-.......\./..........|.........|/.......-......................-...-..|\|........\.
..................|......-..................|..........\..-../........................-......\...\............
..|...............\.............../.........-./............../.../..../.|\......\..../-.....|....-.........|..
...-..-..............--...|...................................................|.-.../.../.....\.....\.........
.\./.../..............././.........\.........|..\..........\.................\..|.....-......-................
......-...................|../....................|...............|.............|/..\.......|........\......|.
......\/.....|................./..................................|.......|./........|.............-...-......
"""


# In[4]:


from collections import deque

GRID = INPUT.strip().splitlines()
LOCATIONS = {i + 1j * j: x for i, l in enumerate(GRID) for j, x in enumerate(l)}


def energized(start, dir):
    deck = deque([(start-dir, dir)])
    seen = set()
    while deck:
        l, d = deck.pop()
        print("LD", l,d)
        if (l, d) in seen:
            continue
        seen.add((l, d))
        nl = l + d
        if nl in LOCATIONS:
            tile = LOCATIONS[nl]
            print(tile)
            if tile == "|" and d.imag:
                nd = [1, -1]
            elif tile == "-" and d.real:
                nd = [1j, -1j]
            elif tile == "/":
                nd = [(d * 1j).conjugate()]
            elif tile == "\\":
                nd = [(d * -1j).conjugate()]
            else:
                nd = [d]
            print(nd)
            break
            deck.extend([(nl, x) for x in nd])

    print("Seen",len(seen))
    return len({x[0] for x in seen}) - 1

def day16_puzzle1():
    res = energized(0, 1j)
    print(f"Part 1: {res}")

def day16_puzzle2():
    h = len(GRID)
    w = len(GRID[0])
    entrypoints = [(i * 1j, 1) for i in range(w)]
    entrypoints += [(h - 1 + i * 1j, -1) for i in range(w)]
    entrypoints += [(i, 1j) for i in range(h)]
    entrypoints += [(i + (w - 1) * 1j, -1j) for i in range(h)]
    res = max(energized(*ep) for ep in entrypoints)
    print(f"Part 2: {res}")
from datetime import datetime
print(datetime.now())
day16_puzzle1()
print(datetime.now())
day16_puzzle2()


# In[ ]:
