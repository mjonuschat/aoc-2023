#!/usr/bin/env python
# coding: utf-8

# In[2]:


INPUT = """
#...O.#O...#...#.OOO..O.###O......O#.O.......O..#.....#..O...O.##...O......O...#.#.O.#.#.#...#......
.#OO..#.#.O.#..O....#O..O##.OO...#..#O...OO....O....#O.......O....##.....#O....#.#..OO#O..O#......OO
O..##..#...O.O..O.#..#.O....O....#...#.......O..#......#O..#.#....O#.O....#..O#.O.#O.O..O....#.....O
O.O.#....#...OO...#..O..O#OO.O...O.........O..##O#..O#...OO.....O....O...O.O..#.O#....O.....O....#..
#.#..O...#.#..##.O.OO.O.......O..#.O...#.O.#O#..OOO....O....#....#O..####.O...O.........O......#...#
.O.O#.OO..##...O.....O..#O.##O.#.OOO.#.#O..#.O.#O.#OOO......O...#.......#...##..#...O....#OO#O.O.#..
..#.#.......O...#.#.O####.........OO.....O.OO.O..#..#..O.O..O....OOO..###.#....O##......OO..........
...O.O.O..#O.....O.O.O.......#.....O##......O.O....O.....#.###...O#...#O..#....#.O..O...#...#.##..O#
..O.O...#OO#..OO..O..OO#..#.O...#...O.#.......O#.##.O#O.OO.......#.#.OO#O.O...#.O.O.....O.O#.O.#O.O.
.....O.##O#...O.O.............OO.......#O.#OO.O....O..O#...O.#.#.#..#.O#O.O.....##O.O...O.......O.#.
...#.#O#....O.O..#....OO.OO...##.#..O.OO.OO..O.OO#.O...O.#.#...OO....O....##...#O....#.OOOO..O..OOO.
....#.O.O#OO....#.#O..#..O..OOO#OOO..#.OO.O..O.O....#..O.##O..#...O...O....#O...OO...........O..O...
.OO...##.O.....O.#....O.....OO..#.......#O##..O##.#O..........OO.OO........O...O..#..#..#O.OO...#O..
..O#O#..#.#...#OO..O...#.O..#..OOOO####....O.O..O........OO..OO...##...#....#..#.OO..#...O....O.O...
##...#O.......O.O##....O.OO#...........O#.....O##....O#.O#O......O#.#......##...OO#....O...O.OO.O#.#
.....O..........O.O..OO......#....O##..#......O.#.#..O.#.#...O.#.O#.O...O#.OO...#.#.O..O#.#.O.#....#
....O.O......#.OO#...........#......#.O.O..O#O#.#.O.##.#.#O.O#OO...O...##......#.#..#..#..O....O#O#.
##.O.OO..#O.#O.....O..O.O..O....O...#.#O.O.#O#.#O##OO..O...O.O......O#O...O#...#.#......##..O..O.#O.
...O...O..OO..#.O..OO.....#..O......O.....#..O....#.O..#..O.O#.#.O......O.OO...O..O..O......O.#...O.
.#..##...OO..#..#...#O..O.....#O#....#.....#.O.....O.....##O...O.#..#OO.......#...#..........##....#
...O........OO.#.O...#O..OO..O#.........##..#O...O....#...O..#..........#...#.....#.O.O......#...OO.
##O......O#.O...O.##..O......OO.O#O.#...O.O#.##.#.#.O.#..#..........O..##.O.........O.O...#....O...O
#.#..O.#.##OO......OO...O.OO...#.O.OO..O.#....O........O..#...O.##...##.#.O..O.O#..OO#...O...#...#O.
.#O..O..#..O..O.#OO#....##....O.##..###.#..O#.#..#........OO#..O.#..#........O....O#.O.O.......#..##
...#.........O#O.#O..#...#......##.O.O...OO#...#....#........##...OO#.......O..OOOO...##...O#..O#O..
..#.OOO##...#.O#..#..#.OOO..#O..#....##.O...OO.#O...O..OOO#O..O.OO..#....#.#.........#...#..#.#.#..O
.O..O.O#...#O.O...O...O....O#.O..#.O#....O.O.O..#.O...O...O.O.O.....O.......O.O##.#...O.O#..........
..#..#.....O##...O.#...O#....#..OO.#.O..O...#O.#.O....#...O....O..##..###....#....OO#..O......O#....
....#O.....O.....#..O.#..OO#.....#O...O.OO##..#.....O..#...O...O..........O....OO.O..O..O..##.......
.###O..O.........O..##.#......O#O......O..#.....##.......O.....#..#.#O#O##..#.#....OO....O#.###.O.#.
OO#....#........O..##O..#.OO.........O...O......OO.O#OO.O#O..O#O..#..##O.#.OO#...O.....O##....O....#
#...........O..#OO..#.##O...O##.O.......O#.O......O###O#..#OO##....O.OO#.......O........#O.....#....
O#O...#.##.O....O....OO....O.O.O#.O#O....O#......OO...O.....#............O.OO#...O...#.O.O.O#....O..
...O.#.O..O..O..O.#O..O#.#..O..O.....#.#.#..O.OO.O#O.O#.............O.#.#.....#OOO.O...O#.#...##.O..
#.....O#.....#...O.#..OOO.#..#OO....O....#.O...........#..OO...##.O..#O...#.##.....O....#..........O
..O..#...O..O#O.O.#.#O#.#..OO..##.#O.#.#..#.........O...#.O.#.##.##.O...#..##...O......O....#..O....
##.......#......O.O.#..#O...#.....#.#.#.O.......#....#O.O##O.......O..#..#.......O.....O...#.#...#..
O#O#..#O.....#..##O#..O.#.....O#...O.#...O#OOO.#O.O.#.#....#.O##OO....#........#.O.O.O.#.#O.......O.
O.O..O#O......OO...O..#OO..#......O.......#.O....#..#.#O###OO.O...#...O.#.O.OO.O.####.#..#.#..O..O.#
........O.#..##.O.###OO#.#O.O##.....O##...O.....#........##.O.##.O........O.#....#.#...OO.O.O...O##O
..#........O.#..OO##O.......#...#.O.O.OO##...#........#..##.#.O.O..O.....O....O.O#O..O..O.O.#.O.....
..O#..OO.O...#.##..#.#..O...O...O#.#O.#...#O...O.#...OO..##.OO.#.O.#.##...O.....#......#..O.O.....O.
..O..O..O..O.O..#...#O#.....O.##O..OO.#..O.OO#.O......O..#....O.O.O..O#.....O.#..O...O#..##.#O.O#.O.
..O#.O.OO##O##..O.##O...#OO#.....O...O.OO....OO###.OO...#O#O..##.O.O...#O.#.OOO.O..#.#O.#.O..#....O.
.....O....#OOO..O#.O#.#.O....O..OOO.............O#...O.....OO.#OOO#....O...O...#...O.##.##O#O.......
#...#.#O.....O#OO#......#.O#O..OO....O.....OO.#......#...#....#O.O#O...OO..#....O.....O#....O..#OO#.
OO.O...O.#.....#O....#.#......#.#.#..#.#.O....O##O.O..#....#O...#.##.#O..#..O...#....#..O.##O.#..O.#
##.#.#...O#O..#....#.##.O.O.O...#.OO..#....OOOO..#...OO.......O....O....OO..OO.....O...#OO...#O.....
...O##...OO..........O..O..O.#...OOO.OOO..O.O.......O.O.O#..O....O#...O.#OO#.#.#.#.....#...#.O..#O.O
#...O..OO........#...#.O......#.OO...O.O.#....O..#.O..#......#...O#...........O..##O..O......O#.#...
O....O#..#O.O.............#....O..O.O.#O.O...O...#....O.#.#...O..#....O.........OO....O.O#OO.....O..
...O..O..O.OO#.#O.....O.O#.O.#..##...#.#O...#.OOOOOO..#..O#.#O#.O.#.O..#.O.O#..##...O.......#O#O..OO
#..#.....O.#O#.O.......#.O#.O.#....#.O.....OO..O.#O#..#O...O.........#O.O#.#......#O....O.O.OO.#O...
.OO#.O.##.O.#.......###...O........#....O.O#.OO#.....#...#...O.##....O.#..O...O...O..OO....O#..O..O.
#O.O............O.O....#OO#..O.......O.....OO.............O#.O#...OO.......#.O.##...#......O.#......
#..O..#...........O..#.O#..##..O#..O..#..#...##.##OO..#O.....O.O.#..O.###.......OO......OOO...OO...O
....#OO.O....#.OO.O..##O..OO.O#.#O..O..O.#.#.#....#O.O##O.......O#......##.O#.#O#.#.O....#..##.#....
...O....#.....OO.O.#..##..O...##.#.....#.O.O...O......O#....O.........O..OOO.......O.#.#..#.....O..#
.OOO...##......O#.#..O......#.#..#O..#O#.....#...O#....O.O.O.O.#O###..#....O.#..O#O..........O......
O.#..O...O.O..#O..#....O#.O....#......O#..O.#....OO....O..O....O....#.#O.O.##O.#..O#....O#...##..OO.
.............O.........OO........O...O.OO.#.OOO...O..O#.......##....#O...OO....#.O.O...OOOO...O.#..#
...O.#O....#.......#.O.O##O............OOO...#..#..##...OO##..#....O...#O##..OOO..O..#..O#......O...
O...O...#..##......#.O.O..#....OOO.O..OO...##...O.O.......#.#.#.....##...O..#O.#...O.........OO....#
O#O#.....O..#..O#.O...###...O.OO.#O.O#.O.#...#........#O.O........O.#..O#........#....#O...O#O#.....
...#.O....#..O....#O.....O...O.#.##O.O#OO#.O.O.##O.......##......O#..#..#.....OO......#O.#O...OO.###
......OO#OO..O#O.....O.#.O#.O.#O....O....#.O..#...#.#....#.OO...O......#..O.#O#.#.....O.O.O.#....O..
#O....O.O....O.O....#....##...#OO.O##...O....##........#.#..O................O#O.O....O..#...##O.#..
###O#....#O#O.O.OO....#.........O#.#.O...O#..#.O.....#....#.O......O..O##.......#......O.....O....O#
......OO.#.#O..O...O........O#.....O...#OO##OOO....O#..O.O..........O....O.....OO.O..OOO.O....O.O#..
O..#..O#O.....OO##..O#...OO.....##O#O.O..O...#OOOOO.OO#.O...O....O#O#.##....#O....O......O....OO.##.
..O.....OO#O...........O...#...O.O#O.......OOO.....#.O....#.#....O..#.#.............O...O.....OOOO.O
...OO..O.....#..#.O.O..#.O..OOOOO....O.#...#..#.OO......O#.#O.##..##............O....O.O.O.....O...#
#.....O....#O..#..O..#..#.OO#.#.O.#...#.....O..#.......OO#O.#......#..O.O...O.#.#...O##O.....#OO#...
.O.#...O.OO...#...........#..##..#...O.#....O.#...#....OO..#.....#...##..#...#OO.......OOOO..O....#.
..#.##..O.O.....O#.......#..#........#.###.O...#.O#O#OO.OO.O#..#.O..#.OO#..#OO....#O..#.........#OO.
..#........O#...O....O..O..##..###O..................O......O.#.O.O.#OOO.#OO....#..O#......OO.OOO...
..#O.#O..O..OO#..#..#.OO.OOO.#.OOOO..O#...O#...O....#O........#............O.O....#...OO.O..#.OO....
.OO#....#.#O.#O#O.#.##......#...#..O.O.##......#.#..#...#............#O....##.OO.O.O........#OO.#.#.
..##.......#.O#...OO......##.OO...O.........#........O...........#O.O##OO...........#.O.O..OO.......
OO##O#.....#.#O..#......#....#OO.#O....###.#.....##.O.O#..O....#O.#.....##.##..O#.O.....#.....#O.#..
##...O#.OO.O..O.O.O#...#.#..#.#.O..#O.....O#.........O#.........O...#...#.O......O..#O..#O..O.#O.O.O
..O......O#...O......OOO..O.....OO.....##.....#O.........O.......#......O#...O.#..O.......#....#....
O..#.O..#.#.......#O.#.##O..O#.O##....#.#.OO..OO....#O..O..O....#...O.#....#.#.O#......O.#......O...
.O..##.#O.O...#O...#.O.O.#...O..OO..#O...#OO......O...O.....OO........#.O...#..O#.O.#.O..O...O#....O
..O....#.##...O##.O#..#.O.O.#..OOOO.....#OO.O....#...#O....O........#..O...#O#..O#.#..O#...OOO#.O...
.O#...O#....#..O...#..O.O.#..#.#........#.OO.O.O.#................##....#.....#...O.#...#.....O.#...
..O.........##.O..O.....OO##..OO#O.#...#O##....#...#.......##.......O#......O#..O#..O.##....O..#....
.O.O..#O......#..#..##....O..O#O..O#...O.##...O..O..#.O.OO....O.##....##.OO..O.........O#.#...#.##..
......O...O.#..OO#......#.....OO.O.##.#...#O.O#....O....#.O............O........#.OO#......OO##..O..
O#O..O...O.O....OO.....##O.....OOO..OO.....#O...OO.#....#.O.......#.#.........#O..#..O##.#.O.#.OO.#.
#O#O..##.##O.....O.O.#..O....#.O#.......O......#O..O.O...O.O..O...#OO.....##..#.....O.#..#O..O.O.#..
.O.##...#....#..#O...##O...##..#.O..O.#..#O...O.O........#.O...O...O#.OO..O.##..O#.O.O#..#OO##OO...O
.##..#..O....OO......#OO..#.....OO.O..#.O..O.O#..#.O#........O....O..O..#....O..#...##.#OOO...#OO#OO
#.#O...#...OOO#.....#.#O.##...##O...#....O......O....#O.#.O......#.....O....O....O.O.#..#O...##O....
......#..OOOO.....O....#.#.##O.#..#..O.#........O....#....#...OO....#..O.......O...OO#....#.#O..#..#
###..O...#...O#.OO.#.#O..O.#.#..##.##OOO.O....#O.#.#....O.#O..O..#O...OO.O.O.O.O#..O......O.#.#..OO.
.#O....###.......O#..#O#O...#....O.OO#..O.#O.O#.O.##..#....#...OO..#.O###..O...........##.O...##.#.O
...OO.#.#..O#.....##OO.......O..##..OO.#..........#.OO..OO..#.#O....O.#..O...O......O....O.O#...O...
..O....#.O#..O..#.....O..O#..#OO......#...OO.O#OO..#O#..O#.......#...O.#.OO.##.O#O....O..#..#O..O.#.
...#O....OOO.#OOO.....O..##..OOOO..O..#..#.#...O..#.O..........#OOO.#.O.....OOO.O..#..O..O.#.....#.#
"""


# In[14]:


import copy

SPINS = 1000000000

def make_grid():
    grid = [list(line.strip()) for line in INPUT.strip().splitlines()]
    height = len(grid)
    width = len(grid[0])
    return grid, width, height


def roll_north(grid, width, height):
    new_grid = copy.deepcopy(grid)
    for j in range(height):
        for i in range(width):
            if grid[j][i] == "O":
                jj = j
                while jj > 0 and not (
                    new_grid[jj - 1][i] == "O" or new_grid[jj - 1][i] == "#"
                ):
                    jj -= 1
                new_grid[j][i] = "."
                new_grid[jj][i] = "O"
    return new_grid


def rotate_cw(grid):
    return [list(x) for x in list(zip(*grid[::-1]))]


def score(grid, width, height):
    return sum(
        (height - j) for i in range(width) for j in range(height) if grid[j][i] == "O"
    )


def day14_puzzle1():
    grid, width, height = make_grid()
    result = score(roll_north(grid, width, height), width, height)
    print(f"Part 1: {result}")


def day14_puzzle2():
    grid, width, height = make_grid()
    seen, reverse_seen = {}, {}
    loop_start = 0
    loop_length =  0

    for i in range(SPINS):
        for _ in range(4):
            grid = roll_north(grid, width, height)
            grid = rotate_cw(grid)

        fingerprint = "".join(["".join(x) for x in grid])
        if fingerprint in seen:
            loop_start = seen[fingerprint]
            loop_length = i - loop_start
            break
        seen[fingerprint] = i
        reverse_seen[i] = grid

    grid = reverse_seen[loop_start + ((SPINS - loop_start) % loop_length) - 1]
    print("Part 2:", score(grid, width, height))


day14_puzzle1()
day14_puzzle2()


# In[ ]:




